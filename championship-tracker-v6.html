<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Championship Tracker</title>
    <!-- Use Tailwind CSS from a CDN for simple, effective styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Road+Rage&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
                 @font-face {
    font-family: 'RoadRage';
    src: url('https://radian-motorsport.github.io/Endurance-Planner-Backend/RoadRage.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
        .road-rage-font {
            font-family: 'RoadRage', sans-serif;
        }

        h1 {
            color: #ffffff; /* A dark color for the text */
            text-shadow: 3px 3px 0px #000000; /* The text-shadow property */

        }
        h3 {
            color: #ffffff; /* A dark color for the text */
            text-shadow: 3px 3px 0px #000000; /* The text-shadow property *//* Gradient text for h3 */

        }
        h4 {
            color: #ffffff; /* A dark color for the text */
            text-shadow: 3px 3px 0px #000000; /* The text-shadow property *//* Gradient text for h2 *//* Gradient text for h4 */
        }
        
        h2 {
            font-size: 4em;
            font-weight: SEMIbold;
            
            /* Apply the gradient to the background */
            background-image: linear-gradient(to right, #00ffff, #d400ff);
            
            /* Clip the background to the text */
            -webkit-background-clip: text;
            
            /* Make the text color transparent */
            -webkit-text-fill-color: transparent;
            
            /* This is a fallback for browsers that don't support the above */
            color: #4a90e2; 
        
            /*text-shadow: 3px 3px 0px #ffffff; /* The shadow property */
            
        }

        /* The pseudo-element for the shadow */
        
        
    </style>
</head>
<body class="bg-neutral-900 text-neutral-100 p-4">
    
    <div class="max-w-4xl mx-auto bg-neutral-900 p-6 md:p-10 rounded-xl shadow-lg transition-colors duration-500">
    <div class="text-center mb-6">
            <img src="https://github.com/Radian-Motorsport/Endurance-Planner-Backend/blob/main/g457912.png?raw=true" alt="?" class="mx-auto w-100  h-auto">
        </div>
    <div class="container mx-auto max-w-4xl p-8 bg-neutral-800 rounded-2xl shadow-lg border border-neutral-700">
        <h2 class="text-5xl road-rage-font text-center  mb-2">MX5 Championship Tracker</h1>
        <p class="text-center text-neutral-400 mb-8"></p>

        <!-- Navigation Buttons -->
        <div id="nav-buttons" class="flex justify-center space-x-4 mb-8">
            <button id="show-admin-btn" class="bg-neutral-800 hover:bg-amber-600 text-neutral-900 font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200">Admin</button>
            <button id="show-round-btn" class="bg-neutral-800 hover:bg-green-700 text-neutral-900 font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200">New Round</button>
            <button id="show-results-btn" class="bg-neutral-800 hover:bg-red-500 text-neutral-900 font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200">Results</button>
        </div>

        <!-- Custom Message Box -->
        <div id="message-box" class="fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-neutral-900 bg-opacity-75 absolute inset-0"></div>
            <div class="bg-neutral-800 p-8 rounded-2xl shadow-xl z-10 max-w-sm w-full border border-neutral-700">
                <p id="message-text" class="text-center text-lg font-semibold text-white mb-4"></p>
                <div class="flex justify-center">
                    <button id="message-ok-btn" class="bg-amber-500 hover:bg-amber-600 text-neutral-900 font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-200">OK</button>
                </div>
            </div>
        </div>

        <!-- Custom Confirmation Modal -->
        <div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-neutral-900 bg-opacity-75 absolute inset-0"></div>
            <div class="bg-neutral-800 p-8 rounded-2xl shadow-xl z-10 max-w-sm w-full border border-neutral-700">
                <p id="confirm-text" class="text-center text-lg font-semibold text-white mb-6"></p>
                <div class="flex justify-around space-x-4">
                    <button id="confirm-yes-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-200">Yes</button>
                    <button id="confirm-no-btn" class="bg-neutral-500 hover:bg-neutral-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-200">No</button>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page">
            <h1 class="text-2xl road-rage-font mb-4 text-white"></h1>
            <div class="mb-8 p-6 bg-neutral-700 rounded-xl border border-neutral-600">
                <h3 class="text-xl road-rage-font mb-4 text-white">Add Drivers</h3>
                <form id="driver-form" class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="new-driver-name" placeholder="Enter driver name" class="flex-1 p-3 rounded-lg border border-neutral-600 bg-neutral-800 text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                    <button type="submit" class="bg-amber-400 hover:bg-amber-600 text-neutral-900 font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
                        Add Driver
                    </button>
                </form>
                <div id="driver-list" class="mt-4">
                    <h4 class="text-lg road-rage-font text-neutral-300 mb-2">Current Drivers:</h4>
                    <div id="drivers-container" class="space-y-2"></div>
                </div>
            </div>
            
            <!-- Admin Page: Rounds Table -->
            <div class="mb-8 p-6 bg-neutral-700 rounded-xl border border-neutral-600">
                <h3 class="text-xl road-rage-font mb-4 text-white">Rounds</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-neutral-600 rounded-xl overflow-hidden">
                        <thead class="bg-neutral-600">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Round</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Track</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-bold text-neutral-200 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rounds-table-body" class="bg-neutral-800 divide-y divide-neutral-600"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Round Page -->
        <div id="round-page" class="page hidden">
            <h1 class="text-2xl road-rage-font mb-4 text-white"></h1>
            <div class="mb-8 p-6 bg-neutral-700 rounded-xl border border-neutral-600">
                <h3 id="round-page-title" class="text-xl road-rage-font mb-4 text-white">Add New Round</h3>
                <form id="race-meta-form" class="flex flex-col sm:flex-row gap-4 mb-4">
                    <input type="text" id="track-name" placeholder="Track Name" class="flex-1 p-3 rounded-lg border border-neutral-600 bg-neutral-800 text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                    <input type="number" id="round-number" placeholder="Round Number" min="1" class="flex-1 p-3 rounded-lg border border-neutral-600 bg-neutral-800 text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                </form>
                
                <h4 class="text-lg road-rage-font text-white mb-2">Driver Positions</h4>
                <div id="race-results-container"></div>
                
                <!-- Fastest Lap Section -->
                <div class="p-3 rounded-lg border border-neutral-600 bg-neutral-800 flex items-center gap-2">
                    <label for="fastest-lap-driver" class="flex-1 text-neutral-300 font-medium">Fastest Lap Driver</label>
                    <select id="fastest-lap-driver" class="flex-1 p-2 rounded-lg border border-neutral-600 bg-neutral-700 text-neutral-100 text-center">
                        <option value="">Select a Driver</option>
                    </select>
                </div>

                <div class="flex justify-end mt-4">
                    <button id="save-round-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105">
                        Save Round
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div id="results-page" class="page hidden">
            <h2 class="text-2xl road-rage-font mb-4 text-white"></h2>
            
            <!-- Championship Standings Table -->
            <div id="standings-section" class="p-6 bg-neutral-700 rounded-xl border border-neutral-600 mb-8 hidden">
                <h3 class="text-xl road-rage-font mb-4 text-white">Championship Standings</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-neutral-600 rounded-xl overflow-hidden">
                        <thead class="bg-neutral-600">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Position</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Driver</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Points</th>
                            </tr>
                        </thead>
                        <tbody id="standings-table-body" class="bg-neutral-800 divide-y divide-neutral-600"></tbody>
                    </table>
                </div>
            </div>

            <!-- Individual Race Results Tables -->
            <div id="individual-races-section" class="hidden">
                <h3 class="text-xl font-bold mb-4 text-white"></h3>
                <div id="races-container" class="space-y-6"></div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Global data stores
        let drivers = [];
        let races = [];
        let editingRaceId = null;

        // Points mapping for top 10 positions
        const pointsMap = {
            1: 25, 2: 18, 3: 15, 4: 12, 5: 10, 6: 8, 7: 6, 8: 4, 9: 2, 10: 1,
        };
        const fastestLapPoints = 1;

        // DOM element references
        const pages = document.querySelectorAll('.page');
        const showAdminBtn = document.getElementById('show-admin-btn');
        const showRoundBtn = document.getElementById('show-round-btn');
        const showResultsBtn = document.getElementById('show-results-btn');
        const newDriverNameInput = document.getElementById('new-driver-name');
        const driverForm = document.getElementById('driver-form');
        const driversContainer = document.getElementById('drivers-container');
        const roundsTableBody = document.getElementById('rounds-table-body');
        const roundPageTitle = document.getElementById('round-page-title');
        const trackNameInput = document.getElementById('track-name');
        const roundNumberInput = document.getElementById('round-number');
        const raceResultsContainer = document.getElementById('race-results-container');
        const fastestLapDriverSelect = document.getElementById('fastest-lap-driver');
        const saveRoundBtn = document.getElementById('save-round-btn');
        const standingsTableBody = document.getElementById('standings-table-body');
        const racesContainer = document.getElementById('races-container');
        const standingsSection = document.getElementById('standings-section');
        const individualRacesSection = document.getElementById('individual-races-section');

        // Message Box and Confirm Modal
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const messageOkBtn = document.getElementById('message-ok-btn');
        const confirmModal = document.getElementById('confirm-modal');
        const confirmText = document.getElementById('confirm-text');
        const confirmYesBtn = document.getElementById('confirm-yes-btn');
        const confirmNoBtn = document.getElementById('confirm-no-btn');

        let confirmCallback = null;

        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        function showConfirmModal(message, callback) {
            confirmText.textContent = message;
            confirmCallback = callback;
            confirmModal.classList.remove('hidden');
        }

        function hideConfirmModal() {
            confirmModal.classList.add('hidden');
            confirmCallback = null;
        }

        messageOkBtn.addEventListener('click', () => messageBox.classList.add('hidden'));
        confirmYesBtn.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback(true);
            }
            hideConfirmModal();
        });
        confirmNoBtn.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback(false);
            }
            hideConfirmModal();
        });

        // --- Page Navigation Functions ---
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }

        showAdminBtn.addEventListener('click', () => {
            showPage('admin-page');
            renderAdminRaces();
        });
        showRoundBtn.addEventListener('click', () => {
            showPage('round-page');
            editingRaceId = null; // Reset editing state
            roundPageTitle.textContent = "Add New Round";
            renderRaceResultsForm();
            // Clear form inputs
            trackNameInput.value = '';
            roundNumberInput.value = '';
            fastestLapDriverSelect.value = '';
        });
        showResultsBtn.addEventListener('click', () => {
            showPage('results-page');
            renderResults();
        });

        // --- Data Persistence ---
        function saveData() {
            localStorage.setItem('drivers', JSON.stringify(drivers));
            localStorage.setItem('races', JSON.stringify(races));
        }

        function loadData() {
            const savedDrivers = localStorage.getItem('drivers');
            const savedRaces = localStorage.getItem('races');
            
            if (savedDrivers) {
                drivers = JSON.parse(savedDrivers);
            }
            if (savedRaces) {
                races = JSON.parse(savedRaces);
            }
        }

        // --- Admin Page Logic ---
        driverForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = newDriverNameInput.value.trim();
            if (name) {
                const newDriver = { id: Date.now(), name: name };
                drivers.push(newDriver);
                saveData();
                renderDrivers();
                newDriverNameInput.value = '';
            }
        });

        function renderDrivers() {
            driversContainer.innerHTML = '';
            // Sort drivers alphabetically by name
            const sortedDrivers = drivers.sort((a, b) => a.name.localeCompare(b.name));

            sortedDrivers.forEach(driver => {
                const driverDiv = document.createElement('div');
                driverDiv.className = 'flex justify-between items-center p-3 rounded-lg border border-neutral-600 bg-neutral-800';
                
                driverDiv.innerHTML = `
                    <span class="text-neutral-100">${driver.name}</span>
                    <div class="space-x-2">
                        <button onclick="editDriver(${driver.id})" class="text-amber-500 hover:text-amber-600 font-medium text-sm">Edit</button>
                        <button onclick="deleteDriver(${driver.id})" class="text-red-500 hover:text-red-600 font-medium text-sm">Delete</button>
                    </div>
                `;
                driversContainer.appendChild(driverDiv);
            });
        }

        function editDriver(driverId) {
            const driverToEdit = drivers.find(d => d.id === driverId);
            if (!driverToEdit) return;
            
            const newName = prompt(`Enter new name for "${driverToEdit.name}":`, driverToEdit.name);
            
            if (newName && newName.trim() !== '' && newName !== driverToEdit.name) {
                driverToEdit.name = newName.trim();
                saveData();
                renderDrivers();
                renderResults(); // Important: update standings with the new name
            } else if (newName === null) {
                // User cancelled the prompt
            } else {
                showMessage('Driver name cannot be empty or unchanged.');
            }
        }

        function deleteDriver(driverId) {
            showConfirmModal('Are you sure you want to delete this driver? All associated race results will be removed.', (confirmed) => {
                if (confirmed) {
                    // Remove races and results associated with the deleted driver
                    races = races.map(race => {
                        const updatedResults = {};
                        for (const pos in race.results) {
                            if (race.results[pos] !== String(driverId)) {
                                updatedResults[pos] = race.results[pos];
                            }
                        }
                        if (race.fastestLapDriverId === String(driverId)) {
                            race.fastestLapDriverId = null;
                        }
                        race.results = updatedResults;
                        return race;
                    });

                    // Remove the driver from the drivers list
                    drivers = drivers.filter(d => d.id !== driverId);
                    
                    saveData();
                    renderDrivers();
                    renderResults();
                }
            });
        }
        
        function renderAdminRaces() {
            roundsTableBody.innerHTML = '';
            races.sort((a, b) => a.round - b.round);
            races.forEach(race => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-neutral-700 transition-colors duration-200';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-100">${race.round}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-300">${race.track}</td>
                    <td class="px-6 py-4 whitespace-nowrap  text-right text-sm">
                        <button onclick="editRace(${race.id})" class="text-amber-500 hover:text-amber-600 font-medium mr-2">Edit</button>
                        <button onclick="deleteRace(${race.id})" class="text-red-500 hover:text-red-600 font-medium">Delete</button>
                    </td>
                `;
                roundsTableBody.appendChild(row);
            });
        }

        function editRace(raceId) {
            const raceToEdit = races.find(race => race.id === raceId);
            if (!raceToEdit) return;

            editingRaceId = raceId;
            showPage('round-page');
            roundPageTitle.textContent = "Edit Round";
            trackNameInput.value = raceToEdit.track;
            roundNumberInput.value = raceToEdit.round;
            renderRaceResultsForm(raceToEdit.results);
            fastestLapDriverSelect.value = raceToEdit.fastestLapDriverId || '';
        }

        function deleteRace(raceId) {
            showConfirmModal('Are you sure you want to delete this round?', (confirmed) => {
                if (confirmed) {
                    races = races.filter(race => race.id !== raceId);
                    saveData();
                    renderAdminRaces();
                    renderResults();
                }
            });
        }

        // --- Round Page Logic ---
        function renderRaceResultsForm(existingResults = {}) {
            raceResultsContainer.innerHTML = '';
            
            // Populate fastest lap dropdown with all drivers
            fastestLapDriverSelect.innerHTML = '<option value="">Select a Driver</option>';
            
            if (drivers.length === 0) {
                raceResultsContainer.innerHTML = '<p class="text-neutral-400">Please add drivers on the Admin page first.</p>';
                saveRoundBtn.classList.add('hidden');
                return;
            } else {
                saveRoundBtn.classList.remove('hidden');
            }

            const positions = Array.from({ length: 15 }, (_, i) => i + 1);

            drivers.forEach(driver => {
                const option = document.createElement('option');
                option.value = driver.id;
                option.textContent = driver.name;
                fastestLapDriverSelect.appendChild(option);
            });

            positions.forEach(position => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2 mb-2 p-3 rounded-lg border border-neutral-600 bg-neutral-800';
                div.innerHTML = `
                    <label class="flex-1 text-neutral-300 font-medium">Position ${position}</label>
                    <select id="pos-${position}-driver" data-position="${position}" class="w-full p-2 rounded-lg border border-neutral-600 bg-neutral-700 text-neutral-100 text-center">
                        <option value="">Select a Driver</option>
                    </select>
                `;
                const select = div.querySelector('select');
                drivers.forEach(driver => {
                    const option = document.createElement('option');
                    option.value = driver.id;
                    option.textContent = driver.name;
                    select.appendChild(option);
                });
                
                // Pre-select the correct driver if editing
                if (existingResults[position]) {
                     select.value = existingResults[position];
                }

                raceResultsContainer.appendChild(div);
            });
        }

        saveRoundBtn.addEventListener('click', () => {
            const trackName = trackNameInput.value.trim();
            const roundNumber = roundNumberInput.value.trim();
            const fastestLapDriverId = fastestLapDriverSelect.value;

            if (!trackName || !roundNumber) {
                showMessage('Please enter a track name and round number.');
                return;
            }

            const raceResults = {};
            const dropdowns = raceResultsContainer.querySelectorAll('select');
            const selectedDrivers = new Set();
            let allPositionsValid = true;

            // Check for duplicate drivers in finishing positions
            dropdowns.forEach(select => {
                const driverId = select.value;
                const position = select.dataset.position;
                if (driverId) {
                    if (selectedDrivers.has(driverId)) {
                        showMessage(`The same driver cannot finish in more than one position.`);
                        allPositionsValid = false;
                        return;
                    }
                    selectedDrivers.add(driverId);
                    raceResults[position] = driverId;
                }
            });
            
            if (!allPositionsValid) return;

            // Check if fastest lap driver exists and is not a duplicate.
            if (fastestLapDriverId && !drivers.find(d => d.id == fastestLapDriverId)) {
                showMessage('Please select a valid fastest lap driver.');
                return;
            }

            const newRace = {
                id: editingRaceId || Date.now(),
                track: trackName,
                round: parseInt(roundNumber, 10),
                results: raceResults,
                fastestLapDriverId: fastestLapDriverId
            };

            if (editingRaceId) {
                const index = races.findIndex(race => race.id === editingRaceId);
                if (index !== -1) {
                    races[index] = newRace;
                }
                showMessage('Round results updated!');
            } else {
                races.push(newRace);
                showMessage('Round results saved!');
            }
            
            saveData();
            showPage('admin-page');
            renderAdminRaces();
            // Reset form
            trackNameInput.value = '';
            roundNumberInput.value = '';
            fastestLapDriverSelect.value = '';
        });

        // --- Results Page Logic ---
        function renderResults() {
            if (races.length > 0) {
                standingsSection.classList.remove('hidden');
                individualRacesSection.classList.remove('hidden');
            } else {
                standingsSection.classList.add('hidden');
                individualRacesSection.classList.add('hidden');
            }
            
            renderStandings();
            renderRaces();
        }

        function calculateStandings() {
            const points = {};
            const fastestLaps = {};
            drivers.forEach(driver => {
                points[driver.id] = 0;
                fastestLaps[driver.id] = 0;
            });

            races.forEach(race => {
                // Add points for positions
                Object.entries(race.results).forEach(([position, driverId]) => {
                    const earnedPoints = pointsMap[parseInt(position, 10)];
                    if (earnedPoints !== undefined) {
                        points[driverId] = (points[driverId] || 0) + earnedPoints;
                    }
                });

                // Add point for fastest lap
                if (race.fastestLapDriverId) {
                    points[race.fastestLapDriverId] = (points[race.fastestLapDriverId] || 0) + fastestLapPoints;
                    fastestLaps[race.fastestLapDriverId] = (fastestLaps[race.fastestLapDriverId] || 0) + 1;
                }
            });

            const standings = drivers.map(driver => ({
                id: driver.id,
                name: driver.name,
                points: points[driver.id] || 0,
                fastestLaps: fastestLaps[driver.id] || 0
            }));

            standings.sort((a, b) => b.points - a.points);
            return standings;
        }

        function renderStandings() {
            const currentStandings = calculateStandings();
            standingsTableBody.innerHTML = '';
            currentStandings.forEach((driver, index) => {
                const flBadge = driver.fastestLaps > 0 ? ` <span class="float-right bg-amber-500 text-neutral-900 text-xs font-bold px-1.5 py-0.5 rounded-full justify-end">FL x${driver.fastestLaps}</span>` : '';
                const row = document.createElement('tr');
                row.className = 'hover:bg-neutral-700 transition-colors duration-200';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-100">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-100">${driver.name}${flBadge}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-300 font-semibold">${driver.points}</td>
                `;
                standingsTableBody.appendChild(row);
            });
        }
        
        function renderRaces() {
            racesContainer.innerHTML = '';
            races.sort((a, b) => a.round - b.round);
            races.forEach(race => {
                const raceDiv = document.createElement('div');
                raceDiv.className = 'p-6 bg-neutral-700 rounded-xl border border-neutral-600';
                
                const raceTitle = document.createElement('h4');
                raceTitle.className = 'text-xl road-rage-font mb-4 text-white';
                raceTitle.textContent = `Round ${race.round}: ${race.track}`;
                
                const tableContainer = document.createElement('div');
                tableContainer.className = 'overflow-x-auto';
                
                const table = document.createElement('table');
                table.className = 'min-w-full divide-y divide-neutral-600 rounded-xl overflow-hidden';
                
                table.innerHTML = `
                    <thead class="bg-neutral-600">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Position</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Driver</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Points</th>
                        </tr>
                    </thead>
                    <tbody class="bg-neutral-800 divide-y divide-neutral-600"></tbody>
                `;
                
                const tbody = table.querySelector('tbody');
                const sortedResults = Object.entries(race.results).sort((a, b) => parseInt(a[0], 10) - parseInt(b[0], 10));
                
                sortedResults.forEach(([position, driverId]) => {
                    const driver = drivers.find(d => d.id == driverId);
                    if (driver) {
                        const isFastestLap = race.fastestLapDriverId == driverId;
                        const points = pointsMap[parseInt(position, 10)] || 0;
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-neutral-700 transition-colors duration-200';
                        
                        const fastestLapBadge = isFastestLap ? ` <span class="float-right ml-2 bg-amber-500 text-neutral-900 text-xs font-bold px-1.5 py-0.5 rounded-full justify-end">FL</span>` : '';
                        const fastestLapPointsCell = isFastestLap ? ` +${fastestLapPoints}` : '';

                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-100">${position}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-300">
                                ${driver.name}${fastestLapBadge}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-300 font-semibold">
                                ${points}${fastestLapPointsCell}
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
                
                tableContainer.appendChild(table);
                raceDiv.appendChild(raceTitle);
                raceDiv.appendChild(tableContainer);
                racesContainer.appendChild(raceDiv);
            });
        }
        
        // Initial setup on page load
        window.onload = function() {
            loadData();
            renderDrivers();
            renderAdminRaces();
            renderResults();
            showPage('admin-page'); // Default to showing the admin page on load
        };
    </script>
</body>
</html>
