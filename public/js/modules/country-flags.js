/**
 * Country to Flag Emoji Mapping
 * Maps country names to their corresponding flag emojis
 */

export const countryToFlag = {
    // Use exact database values
    'United States': '🇺🇸',
    'United Kingdom': '🇬🇧',
    'Germany': '🇩🇪',
    'France': '🇫🇷',
    'Italy': '🇮🇹',
    'Spain': '🇪🇸',
    'Netherlands': '🇳🇱',
    'Belgium': '🇧🇪',
    'Switzerland': '🇨🇭',
    'Austria': '🇦🇹',
    'Canada': '🇨🇦',
    'Australia': '🇦🇺',
    'Japan': '🇯🇵',
    'Brazil': '🇧🇷',
    'Argentina': '🇦🇷',
    'Mexico': '🇲🇽',
    'Jamaica': '��',
    'Venezuela': '�🇪',
    'Guam': '�',
    'Philippines': '🇵🇭',
    'New Zealand': '🇳🇿',
    'Chile': '🇨🇱',
    'Colombia': '🇨🇴',
    'Venezuela': '🇻🇪',
    'Peru': '🇵🇪',
    'Uruguay': '🇺🇾',
    'Ecuador': '🇪🇨',
    'Bolivia': '🇧🇴',
    'Paraguay': '🇵🇾',
    'Costa Rica': '🇨🇷',
    'Panama': '🇵🇦',
    'Guatemala': '🇬🇹',
    'Honduras': '🇭🇳',
    'El Salvador': '🇸🇻',
    'Nicaragua': '🇳🇮',
    'Belize': '🇧🇿',
    'Jamaica': '🇯🇲',
    'Trinidad and Tobago': '🇹🇹',
    'Barbados': '🇧🇧',
    'Bahamas': '🇧🇸',
    'Cuba': '🇨🇺',
    'Dominican Republic': '🇩🇴',
    'Haiti': '🇭🇹',
    'Puerto Rico': '🇵🇷',
    'Guyana': '🇬🇾',  // <- Your "Guana" might be Guyana
    'Suriname': '🇸🇷',
    'French Guiana': '🇬🇫',
    'Ukraine': '🇺🇦',
    'Belarus': '🇧🇾',
    'Lithuania': '🇱🇹',
    'Latvia': '🇱🇻',
    'Estonia': '🇪🇪',
    'Slovenia': '🇸🇮',
    'Croatia': '🇭🇷',
    'Serbia': '🇷🇸',
    'Bosnia and Herzegovina': '🇧🇦',
    'Montenegro': '🇲🇪',
    'North Macedonia': '🇲🇰',
    'Albania': '🇦🇱',
    'Bulgaria': '🇧🇬',
    'Romania': '🇷🇴',
    'Moldova': '🇲🇩',
    'Luxembourg': '🇱🇺',
    'Monaco': '🇲🇨',
    'San Marino': '🇸🇲',
    'Vatican City': '🇻🇦',
    'Malta': '🇲🇹',
    'Cyprus': '🇨🇾',
    'Iceland': '🇮🇸',
    'Faroe Islands': '🇫🇴',
    'Greenland': '🇬🇱',
    'Israel': '🇮🇱',
    'Lebanon': '🇱🇧',
    'Jordan': '🇯🇴',
    'Syria': '🇸🇾',
    'Iraq': '🇮🇶',
    'Iran': '🇮🇷',
    'Afghanistan': '🇦🇫',
    'Pakistan': '🇵🇰',
    'Bangladesh': '🇧🇩',
    'Sri Lanka': '🇱🇰',
    'Myanmar': '🇲🇲',
    'Laos': '🇱🇦',
    'Cambodia': '🇰🇭',
    'Vietnam': '🇻🇳',
    'Mongolia': '🇲🇳',
    'Kazakhstan': '🇰🇿',
    'Uzbekistan': '🇺🇿',
    'Turkmenistan': '🇹🇲',
    'Kyrgyzstan': '🇰🇬',
    'Tajikistan': '🇹🇯',
    'Azerbaijan': '🇦🇿',
    'Armenia': '🇦🇲',
    'Georgia': '🇬🇪',
    'Egypt': '🇪🇬',
    'Libya': '🇱🇾',
    'Tunisia': '🇹🇳',
    'Algeria': '🇩🇿',
    'Morocco': '🇲🇦',
    'Sudan': '🇸🇩',
    'Ethiopia': '🇪🇹',
    'Kenya': '🇰🇪',
    'Tanzania': '🇹🇿',
    'Uganda': '🇺🇬',
    'Rwanda': '🇷🇼',
    'Burundi': '🇧🇮',
    'Somalia': '🇸🇴',
    'Djibouti': '🇩🇯',
    'Eritrea': '🇪🇷',
    'Nigeria': '🇳🇬',
    'Ghana': '🇬🇭',
    'Ivory Coast': '🇨🇮',
    'Senegal': '🇸🇳',
    'Mali': '🇲🇱',
    'Burkina Faso': '🇧🇫',
    'Niger': '🇳🇪',
    'Chad': '🇹🇩',
    'Central African Republic': '🇨🇫',
    'Cameroon': '🇨🇲',
    'Equatorial Guinea': '🇬🇶',
    'Gabon': '🇬🇦',
    'Republic of the Congo': '🇨🇬',
    'Democratic Republic of the Congo': '🇨🇩',
    'Angola': '🇦🇴',
    'Zambia': '🇿🇲',
    'Zimbabwe': '🇿🇼',
    'Botswana': '🇧🇼',
    'Namibia': '🇳🇦',
    'Lesotho': '🇱🇸',
    'Swaziland': '🇸🇿',
    'Madagascar': '🇲🇬',
    'Mauritius': '🇲🇺',
    'Seychelles': '🇸🇨',
    'Comoros': '🇰🇲',
    'Cape Verde': '🇨🇻',
    'Sao Tome and Principe': '🇸🇹',
    'Guinea': '🇬🇳',
    'Guinea-Bissau': '🇬🇼',
    'Sierra Leone': '🇸🇱',
    'Liberia': '🇱🇷',
    'Togo': '🇹🇬',
    'Benin': '🇧🇯',
    'Mauritania': '🇲🇷',
    'Gambia': '🇬🇲'
};

/**
 * Get flag emoji for a country
 * @param {string} country - Country name
 * @returns {string} Flag emoji or default flag
 */
export function getCountryFlag(country) {
    if (!country) return '🏁'; // Racing flag as default
    
    console.log(`🔍 Looking up flag for country: "${country}"`);
    
    // Try exact match first
    const exactMatch = countryToFlag[country];
    if (exactMatch) {
        console.log(`✅ Found exact match: ${exactMatch}`);
        return exactMatch;
    }
    
    // Try case-insensitive match
    const lowerCountry = country.toLowerCase();
    for (const [key, flag] of Object.entries(countryToFlag)) {
        if (key.toLowerCase() === lowerCountry) {
            console.log(`✅ Found case-insensitive match: ${flag}`);
            return flag;
        }
    }
    
    // Try partial match
    for (const [key, flag] of Object.entries(countryToFlag)) {
        if (key.toLowerCase().includes(lowerCountry) || lowerCountry.includes(key.toLowerCase())) {
            console.log(`✅ Found partial match: ${flag}`);
            return flag;
        }
    }
    
    console.log(`❌ No flag found for "${country}", using default`);
    // Default to racing flag
    return '🏁';
}

/**
 * Get country flag with fallback options
 * @param {string} country - Country name
 * @returns {Object} Flag data with emoji and found status
 */
export function getCountryFlagWithStatus(country) {
    const flag = getCountryFlag(country);
    return {
        emoji: flag,
        found: flag !== '🏁',
        country: country
    };
}

/**
 * Alternative flag rendering for systems with poor emoji support
 * @param {string} country - Country name
 * @returns {string} Country code or emoji
 */
export function getCountryFlagOrCode(country) {
    const flag = getCountryFlag(country);
    
    // Test if emoji is supported by checking if it renders properly
    const testDiv = document.createElement('div');
    testDiv.style.fontFamily = '"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji"';
    testDiv.textContent = flag;
    document.body.appendChild(testDiv);
    
    // If emoji width is very small, it's probably not rendering
    const emojiSupported = testDiv.offsetWidth > 10;
    document.body.removeChild(testDiv);
    
    if (!emojiSupported && flag !== '🏁') {
        // Fallback to country codes for common countries
        const countryCodes = {
            'United States': 'US',
            'United Kingdom': 'GB', 
            'Germany': 'DE',
            'France': 'FR',
            'Italy': 'IT',
            'Spain': 'ES',
            'Netherlands': 'NL',
            'Belgium': 'BE',
            'Austria': 'AT',
            'Canada': 'CA',
            'Australia': 'AU',
            'Japan': 'JP',
            'Brazil': 'BR',
            'Jamaica': 'JM',
            'Venezuela': 'VE'
        };
        
        const code = countryCodes[country];
        if (code) {
            return `[${code}]`;
        }
    }
    
    return flag;
}