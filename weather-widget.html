<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Widget for RadianPlanner</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .weather-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .weather-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .weather-info {
            font-size: 14px;
            color: #666;
        }
        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }
        .weather-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 10px;
        }
        .weather-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #666;
        }
        .weather-tab.active {
            color: #0066cc;
            border-bottom: 2px solid #0066cc;
        }
        .weather-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .summary-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #0066cc;
        }
        .summary-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .summary-value {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        .integration-note {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        .integration-note h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="weather-container">
        <div class="weather-header">
            <div class="weather-title">Weather Forecast - Autodromo Internazionale Enzo e Dino Ferrari</div>
            <div class="weather-info">24 Hour Endurance Race</div>
        </div>
        
        <div class="weather-tabs">
            <button class="weather-tab active" onclick="showTab('temperature')">Temperature</button>
            <button class="weather-tab" onclick="showTab('conditions')">Conditions & Precipitation</button>
        </div>
        
        <div id="temperatureChart" class="chart-container"></div>
        <div id="conditionsChart" class="chart-container" style="display: none;"></div>
        
        <div class="weather-summary">
            <div class="summary-card">
                <div class="summary-title">Race Start Temperature</div>
                <div class="summary-value">72°F (22°C)</div>
            </div>
            <div class="summary-card">
                <div class="summary-title">Peak Temperature</div>
                <div class="summary-value">85°F (29°C) at 2:30 PM</div>
            </div>
            <div class="summary-card">
                <div class="summary-title">Night Low</div>
                <div class="summary-value">58°F (14°C) at 5:30 AM</div>
            </div>
            <div class="summary-card">
                <div class="summary-title">Precipitation Chance</div>
                <div class="summary-value">15% (Light shower possible)</div>
            </div>
            <div class="summary-card">
                <div class="summary-title">Wind Conditions</div>
                <div class="summary-value">5-12 mph SW</div>
            </div>
            <div class="summary-card">
                <div class="summary-title">Track Temperature Variance</div>
                <div class="summary-value">+15°F above air temp</div>
            </div>
        </div>
    </div>

    <div class="integration-note">
        <h4>Integration with RadianPlanner</h4>
        <p>This weather widget is designed to integrate with your existing daylight calculation system. Key features:</p>
        <ul>
            <li><strong>Sunrise/Sunset Integration:</strong> Weather data overlaid with your existing daylight calculations</li>
            <li><strong>Temperature Strategy:</strong> Plan tire compounds and fuel strategies based on temperature variations</li>
            <li><strong>Precipitation Alerts:</strong> Coordinate driver changes and setup adjustments with weather windows</li>
            <li><strong>Track Temperature:</strong> Critical for tire performance and pit strategy timing</li>
        </ul>
        <p><strong>API Integration:</strong> This can connect to your server.js daylight endpoints and extend them with weather data.</p>
    </div>

    <script>
        // Generate sample 24-hour weather data for endurance race
        function generateWeatherData() {
            const data = [];
            const startTime = new Date('2024-03-16 14:00:00'); // 2 PM race start
            
            for (let i = 0; i <= 144; i++) { // 24 hours in 10-minute intervals
                const time = new Date(startTime.getTime() + i * 10 * 60 * 1000);
                const hour = time.getHours() + time.getMinutes() / 60;
                
                // Temperature curve: Peak around 2-3 PM, low around 5-6 AM
                let temp;
                if (hour >= 6 && hour <= 18) {
                    // Daytime: sine wave with peak at 3 PM (15:00)
                    temp = 72 + 13 * Math.sin((hour - 6) * Math.PI / 12);
                } else {
                    // Nighttime: gradual cooling
                    const nightHour = hour > 18 ? hour - 18 : hour + 6;
                    temp = 58 + 14 * Math.cos(nightHour * Math.PI / 12);
                }
                
                // Add some random variation
                temp += (Math.random() - 0.5) * 3;
                
                // Cloud cover (percentage)
                const cloudCover = 30 + 20 * Math.sin(hour * Math.PI / 8) + (Math.random() - 0.5) * 20;
                
                // Precipitation chance (higher during afternoon/evening)
                let precipChance = 0;
                if (hour >= 16 && hour <= 20) {
                    precipChance = Math.max(0, 15 + 10 * Math.sin((hour - 16) * Math.PI / 4) + (Math.random() - 0.5) * 10);
                }
                
                data.push({
                    time: time,
                    timeStr: time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                    temperature: Math.round(temp),
                    cloudCover: Math.max(0, Math.min(100, Math.round(cloudCover))),
                    precipitation: Math.max(0, Math.round(precipChance))
                });
            }
            
            return data;
        }

        const weatherData = generateWeatherData();

        // Initialize temperature chart
        function initTemperatureChart() {
            const chart = echarts.init(document.getElementById('temperatureChart'));
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const data = params[0];
                        const index = data.dataIndex;
                        const weather = weatherData[index];
                        return `
                            <div style="color: black;">
                                Time: <span>${weather.timeStr}</span><br>
                                <span>Temperature: ${weather.temperature}°F</span><br>
                                <span>Cloud Cover: ${weather.cloudCover}%</span><br>
                                <span>Chance of Precipitation: ${weather.precipitation}%</span>
                            </div>
                        `;
                    }
                },
                xAxis: {
                    type: 'category',
                    data: weatherData.map(d => d.timeStr),
                    axisLabel: {
                        interval: 12, // Show every 2 hours
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'Temperature (°F)',
                    min: 50,
                    max: 90
                },
                series: [
                    {
                        data: weatherData.map(d => d.temperature),
                        type: 'line',
                        smooth: true,
                        itemStyle: {
                            color: '#ff6b35'
                        },
                        areaStyle: {
                            opacity: 0.1,
                            color: '#ff6b35'
                        }
                    }
                ],
                // Add day/night background
                graphic: [
                    {
                        type: 'rect',
                        left: '10%',
                        top: '10%',
                        width: '80%',
                        height: '80%',
                        z: -1,
                        style: {
                            fill: 'rgba(255, 224, 0, 0.04)' // Day time background
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            return chart;
        }

        // Initialize conditions chart
        function initConditionsChart() {
            const chart = echarts.init(document.getElementById('conditionsChart'));
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const index = params[0].dataIndex;
                        const weather = weatherData[index];
                        return `
                            <div style="color: black;">
                                Time: <span>${weather.timeStr}</span><br>
                                <span>Cloud Cover: ${weather.cloudCover}%</span><br>
                                <span>Precipitation: ${weather.precipitation}%</span>
                            </div>
                        `;
                    }
                },
                xAxis: {
                    type: 'category',
                    data: weatherData.map(d => d.timeStr),
                    axisLabel: {
                        interval: 12,
                        rotate: 45
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'Cloud Cover (%)',
                        min: 0,
                        max: 100,
                        position: 'left'
                    },
                    {
                        type: 'value',
                        name: 'Precipitation (%)',
                        min: 0,
                        max: 100,
                        position: 'right'
                    }
                ],
                series: [
                    {
                        name: 'Cloud Cover',
                        data: weatherData.map(d => d.cloudCover),
                        type: 'line',
                        smooth: true,
                        itemStyle: {
                            color: '#74b9ff'
                        },
                        areaStyle: {
                            opacity: 0.3,
                            color: '#74b9ff'
                        }
                    },
                    {
                        name: 'Precipitation',
                        data: weatherData.map(d => d.precipitation),
                        type: 'bar',
                        yAxisIndex: 1,
                        itemStyle: {
                            color: '#0984e3'
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            return chart;
        }

        let tempChart, conditionsChart;

        // Tab switching
        function showTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.weather-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide charts
            if (tabName === 'temperature') {
                document.getElementById('temperatureChart').style.display = 'block';
                document.getElementById('conditionsChart').style.display = 'none';
                if (!tempChart) {
                    tempChart = initTemperatureChart();
                }
            } else {
                document.getElementById('temperatureChart').style.display = 'none';
                document.getElementById('conditionsChart').style.display = 'block';
                if (!conditionsChart) {
                    conditionsChart = initConditionsChart();
                }
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            tempChart = initTemperatureChart();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            if (tempChart) tempChart.resize();
            if (conditionsChart) conditionsChart.resize();
        });
    </script>
</body>
</html>