<!DOCTYPE html>
<!--
    RadianPlanner - Race Strategy Planning Application
    
    COMPONENT LAYOUT:
    1. Driver Selection
    2. iRacing Series Selection  
    3. Race Information
       - Race/Event Date & Time
       - Track Details
       - TRACK MAP COMPONENT (lines ~170-250)
         * Self-contained SVG visualization
         * Layer controls and interactivity
         * Styles injected by app.js when loaded
    4. WEATHER COMPONENT (lines ~254-262)
       * Dynamic weather charts using ECharts
       * HTML structure & styles injected by app.js
       * Only shown when weather data available
    5. Car Selection
       - Class selection
       - Car details
    6. Strategy Calculation (Page 2)
       - Race inputs
       - Strategy summary
       - Dynamic adjustments
       - Stint breakdown
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RadianPlanner - Race Strategy Planning</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Local Styles -->
    <link rel="stylesheet" href="/public/css/main.css">
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            safelist: [
                'bg-blue-400',
                'text-blue-900',
                'bg-green-400', 
                'text-green-900',
                'bg-yellow-400',
                'text-yellow-900',
                'bg-red-400',
                'text-red-900',
                'bg-neutral-400',
                'text-neutral-900'
            ]
        }
    </script>
    
    <!-- Mobile Font Size Scaling -->
    <style>
        @media (max-width: 640px) {
            html {
                font-size: 10px; /*reduction from default 16px */
            }
            
            /* Force elements to fit within containers */
            * {
                max-width: 100%;
                box-sizing: border-box;
            }
            
            /* Prevent horizontal overflow */
            body {
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            }
            
            /* Ensure containers don't overflow */
            .panel, .glass-strip, .glass-stripe {
                overflow: hidden;
            }
            
            /* Make images and SVGs responsive */
            img, svg {
                max-width: 100%;
                height: auto;
            }
            
            /* Prevent text from breaking out */
            * {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            /* Better touch targets (min 44x44px recommended) */
            /* Only apply to navigation buttons, not form controls */
            button:not(.chakra-tabs__tab):not([data-adjust]) {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Disable text selection on buttons */
            button {
                -webkit-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Prevent zoom on input focus (iOS) - but allow scaling */
            input:not([type="range"]), select, textarea {
                font-size: 16px !important;
            }
            
            /* Allow sliders to scale normally */
            input[type="range"] {
                height: auto;
                min-height: auto;
            }
            
            /* Scale stint table driver dropdowns */
            #stint-table-body select {
                font-size: 0.875rem !important;
                padding: 0.25rem 0.5rem !important;
                min-height: auto !important;
                height: auto !important;
            }
            
            /* Smoother animations */
            * {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* Remove weather display padding on mobile */
            #weather-display, #weather-display-page2 {
                padding: 0 !important;
                margin-top: 0.5rem !important;
            }
            
            #weather-content {
                padding: 0 !important;
            }
            
            /* Remove excessive padding from weather component inner div */
            #weather-display .p-4, #weather-display-page2 .p-4 {
                padding: 0.25rem !important;
            }
            
            /* Weather charts - let them scale naturally */
            #weather-display > div, #weather-display-page2 > div {
                width: 100% !important;
                height: auto !important;
            }
            
            /* Scale weather chart text to use rem instead of fixed px */
            #weather-display canvas, #weather-display-page2 canvas {
                font-size: 1rem !important;
            }
            
            /* Scale chakra tab buttons to match mobile font sizing */
            .chakra-tabs__tab {
                font-size: 1rem !important;
                padding: 0.5rem 1rem !important;
            }
            
            .chakra-tabs__tablist {
                margin-bottom: 1rem !important;
            }
            
            /* Make stint table scrollable horizontally - simple approach */
            #stint-breakdown-display {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
                padding: 1rem !important;
            }
            
            .stint-table {
                width: auto !important;
                min-width: 100% !important;
            }
            
            /* Prevent driver names from overflowing table cells */
            #stint-table-body td {
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                white-space: nowrap !important;
            }
            
            #stint-table-body select {
                max-width: 100% !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
        }
    </style>

</head>
<body class="bg01 text-neutral-200 p-1">
    
    <!-- Debug Mode: Immediate Execution Script -->
    <script>
        // Check for debug mode IMMEDIATELY before anything else renders
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('debug') === 'true') {
            console.log('ðŸ”§ DEBUG MODE: Activating debug view');
            // This runs before the page fully loads
            document.addEventListener('DOMContentLoaded', function() {
                // Hide loading overlay
                const overlay = document.getElementById('page2-loading-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                    console.log('âœ… Loading overlay hidden');
                }
                
                // Show Page 2 and all hidden elements
                const page2 = document.getElementById('page-2');
                if (page2) {
                    page2.classList.remove('hidden');
                    console.log('âœ… Page 2 shown');
                }
                
                // Show all other hidden elements (except loading overlays)
                document.querySelectorAll('.hidden').forEach(el => {
                    const excludedIds = ['loading-overlay', 'loading-overlay-no-blur', 'page2-loading-overlay'];
                    if (!excludedIds.includes(el.id) && !el.classList.contains('loading-overlay')) {
                        el.classList.remove('hidden');
                        el.setAttribute('data-debug-shown', 'true');
                    }
                });
                
                console.log('âœ… Debug mode fully activated - all content visible');
            });
        }
    </script>
    
    <!-- Layout Toggle Switch - HIDDEN -->
    <div class="fixed top-4 right-4 z-50 hidden">
        <button id="layout-toggle" class="flex items-center space-x-2 px-3 py-2 rounded-md bg-neutral-600 hover:bg-neutral-500 text-neutral-200">
            <i id="layout-icon" class="fas fa-mobile-alt text-sm"></i>
            <span id="layout-text" class="text-sm font-medium">Mobile</span>
        </button>
    </div>
    
    <div class="max-w-6xl mx-auto bg01 p-4 md:p-10 sm:p-2 rounded-xl transition-colors duration-500">
        <!-- Header -->
        <div class="text-center mt-6 mb-6">
            <img src="assets/g457913.png" alt="RadianPlanner Logo" class="mx-auto w-100 h-auto">
        </div>
        
        <!-- Admin Button -->
        <!--<button id="admin-btn" class="bg-neutral-900 hover:bg-green-600 text-black font-bold py-1 px-1 rounded-lg transition-all duration-200 transform hover:scale-105 space-x-2">
        </button> -->
        
        <h2 class="text-5xl road-rage-font text-center mb-10">RACE PLANNER</h2>

        <div id="app-container">
            <!-- Navigation -->
            <div class="flex justify-center space-x-4 mb-8">
                <button id="race-details-btn" class="bg-neutral-800 hover:bg-blue-700 text-black font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105 flex items-center space-x-2">
                    <span>DETAILS</span>
                </button>
                <button id="live-tracker-btn" class="panel glass-strip hover:bg-red-500 text-black font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105 flex items-center space-x-2">LIVE</button>
            </div>

            <!-- Page 1: Race Configuration -->
            <div id="planner-page" class="">
                <!-- Driver Selection Section -->
                <div class="p-6 rounded-lg panel glass-strip grad-on-hover">
                    <h1 class="text-xl mb-4 road-rage-font">Drivers</h1>
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <div id="driver-select" class="flex-1 min-w-[200px] relative"></div>
                        <button id="add-driver-btn" class="glass-strip-nb ov-dark hover:bg-purple-700 text-neutral-400 font-bold py-2 px-3 rounded-lg transition-all duration-200 transform hover:scale-100" title="Add Driver">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="refresh-drivers-full-btn" class="glass-strip-nb ov-dark hover:bg-blue-700 text-neutral-400 font-bold py-2 px-3 rounded-lg transition-all duration-200 transform hover:scale-100" title="Refresh All Driver Details">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button id="refresh-weather-btn" class="glass-strip-nb ov-dark hover:bg-orange-700 text-neutral-400 font-bold py-2 px-3 rounded-lg transition-all duration-200 transform hover:scale-100" title="Refresh Weather Data">
                            <i class="fas fa-cloud"></i>
                        </button>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 mb-4">
                        <input type="number" id="new-driver-cust-id" placeholder="Enter iRacing Customer ID" class="p-3 panel glass-strip rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-200 text-neutral-400 text-sm flex-1 min-w-[200px]">
                        <button id="add-driver-by-id-btn" class="glass-strip-nb hover:bg-green-700 text-neutral-400 font-bold py-2 px-3 rounded-lg transition-all duration-200 transform hover:scale-105" title="Add Driver by Customer ID">
                            <i class="fas fa-user-plus"></i>
                        </button>
                    </div>
                    <ul id="driver-list" class="space-y-2"></ul>
                </div>

                <!-- iRacing Series Selection (NEW SECTION) -->
                <div class="p-6 panel glass-strip rounded-lg mt-6 grad-on-hover">
                    <h1 class="text-xl mb-4 road-rage-font">iRacing Endurance Series</h1>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                        <div class="flex flex-col w-full">
                            <label class="text-sm font-medium text-neutral-500 mb-2">Series</label>
                            <div id="series-select" class="w-full relative"></div>
                        </div>
                        <div class="flex flex-col w-full">
                            <label class="text-sm font-medium text-neutral-500 mb-2">Event</label>
                            <div id="event-select" class="w-full relative"></div>
                        </div>
                        <div class="flex flex-col w-full">
                            <label class="text-sm font-medium text-neutral-500 mb-2">Session</label>
                            <div id="session-select" class="w-full relative"></div>
                        </div>
                    </div>
                </div>

                
                <!-- Race Date & Time -->
                <div class="p-6 panel glass-strip rounded-lg mt-6 grad-on-hover">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-4">
                        <h1 class="text-xl road-rage-font">Race Information</h1>
                    </div>
                    
                    <div id="race-info-content" class="idden">
                        <!-- Two Column Layout -->
                        <div class="grid grid-cols-2 gap-8 mb-6">
                            <!-- Left: Race Times, Event Times, and Session Lengths -->
                            <div class="space-y-4">
                                <div class="flex flex-col w-full">
                                    <label class="text-sm font-medium text-neutral-500 mb-2">Race Date & Time <span class="text-xs text-neutral-400">(Simulator Time)</span></label>
                                    <div id="race-datetime" class="text-neutral-200 text-sm"
                                         data-race-date=""
                                         data-race-time=""
                                         data-race-timezone=""
                                         data-race-timestamp="">
                                        Select a session to view race information
                                    </div>
                                </div>
                                <div class="flex flex-col w-full">
                                    <label class="text-sm font-medium text-neutral-500 mb-2">Event Date & Time <span class="text-xs text-neutral-400">(Real World Time)</span></label>
                                    <div id="event-datetime" class="text-neutral-200 text-sm"
                                         data-event-date=""
                                         data-event-time=""
                                         data-event-timezone=""
                                         data-event-timestamp="">
                                        Select a session to view event information
                                    </div>
                                </div>
                                
                                <!-- Session Lengths -->
                                <div class="flex flex-col w-full">
                                    <label class="text-sm font-medium text-neutral-500 mb-2">Session Lengths</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center gap-2">
                                            <span class="text-sm text-neutral-400">Practice:</span>
                                            <span id="practice-length" class="text-neutral-200 text-sm"
                                                  data-practice-minutes=""
                                                  data-practice-hours="">-</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-sm text-neutral-400">Qualifying:</span>
                                            <span id="qualifying-length" class="text-neutral-200 text-sm"
                                                  data-qualifying-minutes=""
                                                  data-qualifying-hours=""
                                                  data-qualifying-laps="">-</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-sm text-neutral-400">Race:</span>
                                            <span id="session-length" class="text-neutral-200 text-sm"
                                                  data-session-type=""
                                                  data-session-time=""
                                                  data-session-laps=""
                                                  data-session-minutes=""
                                                  data-session-hours="">-</span>
                                        </div>
                                        <div id="session-laps-display" class="flex items-center gap-2 hidden">
                                            <span class="text-sm text-neutral-400">Lap Limit:</span>
                                            <span id="session-laps-value" class="text-neutral-200 text-sm">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right: Series Name and Logo Only -->
                            <div class="flex flex-col items-center">
                                <!-- Series Name -->
                                <!--<div id="series-name" class="text-lg font-medium text-neutral-200 text-center hidden"></div>-->
                                
                                <!-- Series Logo -->
                                <img id="series-logo" src="" alt="Series Logo" class="w-60 h-60 object-contain rounded-lg">
                            </div>
                        </div>
                        
                        <!-- Track Details Section -->
                        <div id="track-details-section" class="idden">
                            <div class="border-t border-neutral-700 pt-6">
                                <h3 class="text-lg font-medium text-neutral-300 mb-4">Track Details</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Track Image and Basic Info -->
                                    <div class="flex flex-col space-y-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="relative w-32 h-32">
                                                <!-- Background track image -->
                                                <img id="track-image" src="" alt="Track Image" 
                                                     class="w-32 h-32 object-cover rounded-lg bg-neutral-700 hidden"
                                                     data-image-url=""
                                                     data-image-source="">
                                                <!-- Track logo overlay -->
                                                <img id="track-logo-overlay" src="" alt="Track Logo" 
                                                     class="absolute inset-0 w-32 h-32 object-contain rounded-lg hidden" 
                                                     style="z-index: 10; background: rgba(0,0,0,0.5); padding: 8px;"
                                                     data-logo-url=""
                                                     data-logo-source="">
                                            </div>
                                            <div class="flex-1">
                                                <div id="track-name" class="text-lg font-medium text-neutral-200 mb-1" 
                                                     data-track-id="" 
                                                     data-iracing-track-id="" 
                                                     data-track-database-id="">-</div>
                                                <div id="track-garage61-id" class="text-sm text-neutral-400 mb-1">Garage61 ID: -</div>
                                                <div id="track-config" class="text-xs text-neutral-500">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Track Specifications -->
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Location:</span>
                                            <span id="track-location" class="text-sm text-neutral-200" data-country="" data-region="">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Coordinates:</span>
                                            <span id="track-coordinates" class="text-sm text-neutral-200" data-latitude="" data-longitude="">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Track Length:</span>
                                            <span id="track-length" class="text-sm text-neutral-200" data-length-km="" data-length-miles="">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Corners:</span>
                                            <span id="track-corners" class="text-sm text-neutral-200">-</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ================================ -->
                                <!-- TRACK MAP COMPONENT CONTAINER -->
                                <!-- Self-contained SVG track visualization -->
                                <!-- with layer controls and interactivity -->
                                <!-- Styles injected by app.js when loaded -->
                                <!-- ================================ -->
                                <div id="track-map-section" class="hidden mt-6">
                                    <div id="track-map-container">
                                        <!-- Content will be dynamically generated by TrackMapComponent -->
                                    </div>
                                </div>
                    
                    <!-- ================================ -->
                    <!-- WEATHER COMPONENT CONTAINER -->
                    <!-- Dynamic weather charts using ECharts -->
                    <!-- HTML structure & styles injected by app.js -->
                    <!-- when weather data is available for event -->
                    <!-- ================================ -->
                    <div id="weather-display" class="hidden mt-6">
                        <!-- Content will be dynamically generated by app.js -->
                    </div>
                    
                    <div id="race-info-placeholder" class="text-center text-neutral-500 py-8">
                        <i class="fas fa-info-circle mb-2 text-2xl"></i>
                        <p>Select a session above to view race information</p>
                    </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Car Selection -->
                <div class="p-6 panel glass-strip rounded-lg mt-6 grad-on-hover">
                    <h1 class="text-xl mb-4 road-rage-font">Car Selection</h1>
                    <div id="car-selection-content" class="hidden">
                        <!-- Car Selection Dropdowns -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full mb-6">
                            <div class="flex flex-col w-full">
                                <label class="text-sm font-medium text-neutral-500 mb-2">Car Class</label>
                                <div id="car-class-dropdown" class="w-full relative"></div>
                            </div>
                            <div class="flex flex-col w-full">
                                <label class="text-sm font-medium text-neutral-500 mb-2">Car</label>
                                <div id="car-dropdown" class="w-full relative"></div>
                            </div>
                        </div>
                        
                        <!-- Car Details Section -->
                        <div id="car-details-section" class="hidden">
                            <div class="border-t border-neutral-700 pt-6">
                                <h3 class="text-lg font-medium text-neutral-300 mb-4">Car Details</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Car Image and Basic Info -->
                                    <div class="flex flex-col space-y-4">
                                        <div class="flex items-center space-x-4">
                                            <img id="car-image" src="" alt="Car Image" class="w-32 h-20 object-contain rounded-lg bg-neutral-700 hidden"
                                                 data-car-image-url="">
                                            <div class="flex-1">
                                                <div id="car-name" class="text-lg font-medium text-neutral-200 mb-1"
                                                     data-car-id=""
                                                     data-car-database-id=""
                                                     data-car-garage61-id=""
                                                     data-car-name=""
                                                     data-car-class=""
                                                     data-car-series="">-</div>
                                                <div id="garage61-id" class="text-sm text-neutral-400"
                                                     data-garage61-id="">Garage61 ID: -</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Car Specifications -->
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Weight:</span>
                                            <span id="car-weight" class="text-sm text-neutral-200"
                                                  data-car-weight-kg=""
                                                  data-car-weight-lbs="">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-neutral-500">Horsepower:</span>
                                            <span id="car-hp" class="text-sm text-neutral-200"
                                                  data-car-horsepower=""
                                                  data-car-torque="">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="car-selection-placeholder" class="text-center text-neutral-500 py-8">
                        <i class="fas fa-car mb-2 text-2xl"></i>
                        <p>Select a session above to choose your car</p>
                    </div>
                </div>



                <!-- Continue Button -->
                <div class="mt-8">
                    <button id="continue-button" onclick="window.radianPlanner && window.radianPlanner.uiManager ? window.radianPlanner.uiManager.showPage2() : console.error('RadianPlanner or UIManager not available')" class="w-full panel glass-strip hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
                        Calculate <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>



             <!-- Loading Overlay (Global) - Visible by default, hidden by JavaScript when ready -->
            <div id="page2-loading-overlay" class="fixed inset-0 bg-neutral-950 flex flex-col items-center justify-center z-50">
                <img src="assets/g457913.png" alt="RadianPlanner Logo" class="mx-auto w-32 h-auto mt-4 mb-4">
                <h2 class="text-3xl road-rage-font text-center px-10"> LOADING...</h2>
            </div>

            <!-- Page 2: Race Strategy -->
            <div id="page-2" class="space-y-6 hidden">
                <!-- Event Summary -->
                <div id="event-summary" class="p-6 panel glass-strip mt-6 grad-on-hover rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex flex-col items-center text-center justify-between h-full min-h-[200px]">
                            <div class="relative w-40 h-40 mb-2">
                                <img id="track-image" src="" alt="Track Image" class="w-40 h-40 object-contain hidden">
                                <img id="track-logo" src="" alt="Track Logo" class="absolute inset-0 w-40 h-40 object-contain hidden">
                            </div>
                            <div class="text-center">
                                <div id="page2-track-config" class="text-neutral-400 text-sm"></div>
                                <div id="page2-track" class="text-neutral-200 font-medium text-lg"></div>                               
                            </div>
                        </div>
                        <div class="flex flex-col items-center text-center justify-between h-full min-h-[200px]">
                            <div class="w-40 h-40 mb-2 flex items-center justify-center">
                                <img id="car-logo" src="" alt="Car Logo" class="max-w-40 max-h-40 object-contain hidden">
                            </div>
                            <div class="text-center">
                                <div id="page2-car" class="text-neutral-200 font-medium text-lg"></div>
                                <div id="page2-car-class" class="text-neutral-400 text-sm"></div>
                            </div>
                        </div>
                        <div class="flex flex-col items-center text-center justify-between h-full min-h-[200px]">
                            <div class="w-40 h-40 mb-2 flex items-center justify-center">
                                <img id="page2-series-logo" src="" alt="Series Logo" class="max-w-40 max-h-40 object-contain rounded-lg hidden">
                            </div>
                            <div class="text-center">
                                <div id="page2-series" class="text-neutral-200 font-medium text-lg"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Team Drivers Section -->
                    <div class="mt-6 pt-4 border-t border-neutral-700">
                        <!-- <div class="text-neutral-200 font-medium text-xl mb-4 text-center">Team Drivers</div> -->
                        <div class="flex justify-center">
                            <div id="page2-drivers" class="w-2/3 space-y-3">
                                <!-- Drivers will be populated here with safety rating and iRating -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Race Date & Time Display -->
                    <div class="mt-6 pt-4 border-t border-neutral-700">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center items-center">
                            <div class="flex flex-col items-center">
                                <span class="text-sm text-neutral-500">Projected SOF</span>
                                <span id="page2-projected-sof" class="text-neutral-200 font-medium">-</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <span class="text-sm text-neutral-500">Event Date</span>
                                <span id="page2-race-date" class="text-neutral-200 font-medium">Not selected</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <span class="text-sm text-neutral-500">Event Time</span>
                                <span id="page2-race-time" class="text-neutral-200 font-medium">Not selected</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <span class="text-sm text-neutral-500">Timezone</span>
                                <span id="page2-timezone" class="text-neutral-200 font-medium">Europe/London</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Garage61 Lap Times -->
                <div id="garage61-lap-times" class="p-6 panel glass-strip grad-on-hover rounded-lg mb-6 hidden">
                    <h1 class="text-xl mb-4 road-rage-font">GARAGE61 LAP TIMES</h1>
                    <div id="lap-times-loading" class="text-center py-4 hidden">
                        <i class="fas fa-spinner fa-spin text-2xl text-blue-400 mb-2"></i>
                        <p class="text-neutral-400">Fetching lap data from Garage61...</p>
                    </div>
                    <div id="lap-times-error" class="text-center py-4 text-red-400 hidden">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p id="lap-times-error-message">Error loading lap data</p>
                    </div>
                    <div id="lap-times-content" class="hidden">
                        <div class="panel glass-strip rounded-lg overflow-hidden shadow-lg">
                            <table class="w-full text-neutral-200 text-xs">
                                <thead class=" ov-dark panel glass-strip">
                                    <tr>
                                        <th class="py-2 px-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider border-r border-neutral-500">Driver</th>
                                        <th class="py-2 px-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider border-r border-neutral-500">Best Lap</th>
                                        <th class="py-2 px-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider border-r border-neutral-500">Fuel Used</th>
                                        <th class="py-2 px-3 text-left text-xs font-bold text-neutral-200 uppercase tracking-wider">Conditions</th>
                                    </tr>
                                </thead>
                                <tbody id="lap-times-tbody" class="divide-y divide-neutral-600">
                                    <!-- Lap data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- Garage61 Analysis Panel -->
                        <div id="garage61-analysis" class="mt-4 hidden flex justify-center">
                            <div class="w-full max-w-5xl">
                                <div class="grid xl:grid-cols-1 grid-cols-5 gap-4 text-sm">
                                <div class="flex flex-col items-start">
                                    <span class="text-xs text-neutral-400">Average Lap Time</span>
                                    <span id="g61-avg-laptime" class="text-neutral-200 font-mono">-</span>
                                </div>
                                <div class="flex flex-col items-start">
                                    <span class="text-xs text-neutral-400">Average Fuel Used</span>
                                    <span id="g61-avg-fuel" class="text-neutral-200">-</span>
                                </div>
                                <div class="flex flex-col items-start">
                                    <label class="text-xs text-neutral-400">Safety Margin (%)</label>
                                    <input id="g61-safety-margin" type="number" min="0" max="100" value="0" class="text-center p-1 rounded glass-strip ov-mid text-neutral-200 w-20" />
                                </div>
                                <div class="flex flex-col items-start">
                                    <span class="text-xs text-neutral-400">Adjusted Lap Time</span>
                                    <span id="g61-adjusted-laptime" class="text-neutral-200 font-mono">-</span>
                                </div>
                                <div class="flex flex-col items-start">
                                    <span class="text-xs text-neutral-400">Adjusted Fuel Used</span>
                                    <span id="g61-adjusted-fuel" class="text-neutral-200">-</span>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Race Inputs -->
                <div id="race-inputs-container" class="p-6 panel glass-strip grad-on-hover rounded-lg">
                    <h1 class="text-xl mb-4 road-rage-font">Race Inputs</h1>
                    
                    <!-- Race Mode Toggle: Time vs Laps -->
                    <div id="race-mode-toggle-container" class="hidden flex items-center justify-between mb-4 p-3 rounded-lg panel glass-strip ov-dark">
                        <span class="text-sm font-medium text-neutral-300">Race Mode:</span>
                        <div class="flex items-center space-x-2">
                            <span id="time-mode-label" class="text-sm text-blue-400 font-semibold">Time Limit</span>
                            <div class="relative inline-block w-12 h-6 transition duration-200 ease-in-out bg-neutral-600 rounded-full cursor-pointer" id="race-mode-toggle">
                                <div id="race-mode-slider" class="absolute left-0 top-0 w-6 h-6 transition duration-200 ease-in-out transform bg-blue-500 rounded-full shadow"></div>
                            </div>
                            <span id="lap-mode-label" class="text-sm text-neutral-400">Lap Limit</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-6 mb-6">
                        <div class="flex flex-col">
                            <label class="text-sm font-medium text-neutral-500 text-center mb-2">Race Duration (Minutes)</label>
                            <div class="flex justify-center min-h-[2.5rem]">
                                <!-- Display total race duration in minutes (generated from Page 1). Hidden inputs kept for compatibility -->
                                <div id="race-duration-minutes-display" class="p-2 rounded-lg text-neutral-200 panel glass-strip ov-mid text-center min-w-[5rem]">-</div>
                                <input type="hidden" id="race-duration-hours" value="0">
                                <input type="hidden" id="race-duration-minutes" value="0">
                                <input type="hidden" id="race-laps-limit" value="0">
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <label class="text-sm font-medium text-neutral-500 text-center mb-2">Avg. Lap Time</label>
                            <div class="flex items-center justify-center space-x-2 min-h-[2.5rem]">
                                <input type="number" id="avg-lap-time-minutes" placeholder="" class="p-2 panel glass-strip ov-mid rounded-lg text-neutral-200 text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                                <span class="text-neutral-500 text-sm">min</span>
                                <input type="number" id="avg-lap-time-seconds" placeholder="" class="p-2 panel glass-strip ov-mid rounded-lg text-neutral-200 text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                                <span class="text-neutral-500 text-sm">sec</span>
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <label for="pit-stop-time" class="text-sm font-medium text-neutral-500 text-center mb-2">Avg. Pit Stop Time (sec)</label>
                            <div class="flex justify-center min-h-[2.5rem]">
                                <input type="number" id="pit-stop-time" value="90" class="p-2 panel glass-strip ov-mid rounded-lg text-neutral-200 text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <label for="fuel-per-lap-display-input" class="text-sm font-medium text-neutral-500 text-center mb-2">Fuel Use per Lap (L)</label>
                            <div class="flex justify-center min-h-[2.5rem]">
                                <input type="number" id="fuel-per-lap-display-input" class="p-2 panel glass-strip ov-mid rounded-lg text-neutral-200  text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <label for="tank-capacity-display-input" class="text-sm font-medium text-neutral-500 text-center mb-2">Fuel Tank Size (L)</label>
                            <div class="flex justify-center min-h-[2.5rem]">
                                <input type="number" id="tank-capacity-display-input" class="p-2 panel glass-strip ov-mid rounded-lg text-neutral-200 
                                text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                            </div>
                        </div>

                    </div>
                    
                    <!-- Calculate Button - Outside the grid for better alignment -->
                    <div class="flex justify-center">
                        <button id="calculate-page2-button" onclick="console.log('Button clicked!'); if (window.radianPlanner) { console.log('RadianPlanner found'); try { window.radianPlanner.calculateStrategy(); } catch(e) { console.error('Calculate error:', e); } } else { console.error('RadianPlanner not found'); }" class="panel glass-strip hover:bg-blue-700 text-WHITE font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
                            Calculate
                        </button>
                    </div>
                </div>

                <!-- Strategy Summary -->
                <div id="overall-summary" class="p-6 panel glass-strip grad-on-hover mb-6 hidden">
                    <h3 class="text-xl road-rage-font mb-8">Strategy Summary</h3>
                    <div class="grid grid-cols-4 md:grid-cols-4 lg:grid-cols-4 gap-4 text-neutral-200">
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-flag-checkered fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="est-laps-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Est. Laps</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-hourglass-half fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="stint-duration-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Stint Duration</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-flag fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="laps-per-stint-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Laps per Stint</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-hand fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="pit-stops-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Pit Stops</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-gas-pump fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="total-fuel-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Total Fuel</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-droplet fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="fuel-per-lap-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Fuel per Lap</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-stopwatch fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="lap-time-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mt-1 text-neutral-500">Lap Time</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <i class="fa-solid fa-stopwatch fa-2xl text-neutral-200 mb-4 icon-shadow"></i>
                            <span id="pit-stop-duration-display" class="font-semibold text-lg text-neutral-200 text-shadow"></span>
                            <span class="text-sm mb-4 text-neutral-500">Pit Stop Duration</span>
                        </div>
                    </div>
                </div>

                <!-- Track Map (Page 2) - Above Stint Table -->
                <div id="track-map-container-page2" class="Hidden mt-6 panel glass-strip grad-on-hover rounded-lg overflow-hidden">
                    <!-- Track map toggle button -->
                    <button id="track-map-toggle-btn" class="w-full panel glass-strip ov-dark-hover text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-between">
                        <span class="flex items-center space-x-2">
                            <span>Track Map</span>
                        </span>
                        <i class="fas fa-chevron-down track-map-toggle-icon"></i>
                    </button>
                    <!-- Track map content (collapsible) -->
                    <div id="track-map-content" class="track-map-collapsible">
                        <!-- Track map component content -->
                    </div>
                </div>

                <!-- Weather Display (Page 2) - Above Stint Table -->
                <div id="weather-display-page2" class="Hidden mt-6 panel glass-strip grad-on-hover rounded-lg overflow-hidden">
                    <!-- Weather toggle button -->
                    <button id="weather-toggle-btn" class="w-full panel glass-strip ov-dark-hover text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-between">
                        <span class="flex items-center space-x-2">
                            <span>Weather</span>
                        </span>
                        <i class="fas fa-chevron-down weather-toggle-icon"></i>
                    </button>
                    <!-- Weather content (collapsible) -->
                    <div id="weather-content" class="weather-collapsible">
                        <!-- Weather component content -->
                    </div>
                </div>

                <!-- Stint Breakdown -->
                <div id="stint-breakdown-display" class="p-6 panel glass-strip grad-on-hover rounded-lg overflow-x-auto hidden">
                    <h1 class="text-xl mb-4 road-rage-font">Stints</h1>
                    
                    <!-- Dynamic Adjustments - Horizontal Layout -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Fuel Adjustment -->
                        <div class="flex flex-col">
                            <div class="flex items-center justify-between mb-2">
                                <label for="fuel-slider" class="text-sm font-medium text-neutral-400">Fuel per Lap</label>
                                <div class="flex items-center space-x-3">
                                    <span id="fuel-original-value" class="text-lg font-mono text-neutral-500">-- L</span>
                                    <span id="fuel-adjusted-value" class="text-lg font-mono text-neutral-200 transition-colors duration-300">-- L</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="p-1 rounded-full text-white ov-dark hover:bg-cyan-600 transition-colors duration-200" data-adjust="fuel" data-value="-0.05">-</button>
                                <input type="range" id="fuel-slider" min="-2.0" max="2.0" value="0" step="0.05" class="w-full">
                                <button class="p-1 rounded-full text-white ov-dark hover:bg-fuchsia-600 transition-colors duration-200" data-adjust="fuel" data-value="0.05">+</button>
                                <span id="fuel-slider-value" class="text-neutral-200 font-mono text-sm w-8 text-right">0.00</span>
                            </div>
                        </div>
                        
                        <!-- Lap Time Adjustment -->
                        <div class="flex flex-col">
                            <div class="flex items-center justify-between mb-2">
                                <label for="lap-time-slider" class="text-sm font-medium text-neutral-400">Lap Time</label>
                                <div class="flex items-center space-x-3">
                                    <span id="lap-time-original-value" class="text-lg font-mono text-neutral-500">--:--:---</span>
                                    <span id="lap-time-adjusted-value" class="text-lg font-mono text-neutral-200 transition-colors duration-300">--:--:---</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="p-1 rounded-full text-white ov-dark hover:bg-cyan-600 transition-colors duration-200" data-adjust="lapTime" data-value="-0.1">-</button>
                                <input type="range" id="lap-time-slider" min="-3" max="3" value="0" step="0.1" class="w-full">
                                <button class="p-1 rounded-full text-white ov-dark hover:bg-fuchsia-600 transition-colors duration-200" data-adjust="lapTime" data-value="0.1">+</button>
                                <span id="lap-time-slider-value" class="text-neutral-200 font-mono text-sm w-8 text-right">0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pit Stops Summary - Shows impact of slider adjustments -->
                    <div class="flex justify-center items-center gap-4 mb-6">
                        <div class="flex justify-center items-center p-3 panel glass-strip ov-dark-hover rounded-lg flex-1">
                            <div class="flex items-center space-x-4">
                                <i class="fa-solid fa-hand text-neutral-400 text-lg"></i>
                                <div class="text-center">
                                    <span class="text-sm text-neutral-400">Pit Stops</span>
                                    <div class="text-xl font-bold text-neutral-200" id="stint-pit-stops-display">-</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center items-center p-3 panel glass-strip ov-dark-hover rounded-lg flex-1">
                            <div class="flex items-center space-x-4">
                                <i class="fa-solid fa-flag text-neutral-400 text-lg"></i>
                                <div class="text-center">
                                    <span class="text-sm text-neutral-400">Laps/Stint</span>
                                    <div class="text-xl font-bold text-neutral-200" id="stint-laps-per-stint-display">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Time Display Controls -->
                    <div class="flex flex-col mb-4">
                        <input type="hidden" id="race-start-time-page2" value="13:00">
                        
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-4">
                                <span class="text-sm font-medium text-neutral-300">Time Display:</span>
                                <div class="flex items-center space-x-2">
                                    <span id="race-time-label" class="text-sm text-neutral-400">Race Time</span>
                                    <div class="relative inline-block w-10 h-6 transition duration-200 ease-in-out bg-neutral-600 rounded-full cursor-pointer toggle-switch">
                                        <div id="time-toggle-slider" class="absolute left-0 top-0 w-6 h-6 transition duration-200 ease-in-out transform bg-white rounded-full shadow"></div>
                                    </div>
                                    <span id="local-time-label" class="text-sm text-neutral-400">Local Time</span>
                                </div>
                            </div>
                            
                            <div id="driver-timezone-selector" class="hidden flex items-center space-x-2">
                                <span class="text-sm text-neutral-400">Driver:</span>
                                <select id="driver-timezone-dropdown" class="bg-neutral-800 text-neutral-300 border border-neutral-600 rounded px-2 py-1 text-sm">
                                    <option value="">Select Driver</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stint Table -->
                    <table class="min-w-full divide-y divide-neutral-600 panel glass-strip grad-on-hover rounded-lg stint-table">
                        <thead class="ov-dark panel glass-strip rounded-md">
                            <tr>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 80px;">Stint #</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 110px;">Start Time</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 110px;">End Time</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 100px;">Start Lap</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 100px;">End Lap</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900" style="width: 100px;">Laps</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-r border-neutral-900">Driver</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-neutral-200 uppercase tracking-wider border-neutral-900">Backup</th>
                            </tr>
                        </thead>
                        <tbody id="stint-table-body" class="bg-neutral-700 divide-y divide-neutral-700">
                        </tbody>
                    </table>
                </div>

                <!-- Share/Save Strategy -->
                <div id="share-link-container" class="p-6 panel glass-strip grad-on-hover rounded-lg hidden">
                    <h1 class="text-xl mb-4 road-rage-font">Share/Save This Strategy</h1>
                    <div class="flex items-center space-x-2 mb-4">
                        <button id="generate-share-btn" class="panel glass-strip ov-dark hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
                            <i class="fas fa-share-alt mr-2"></i> Generate Link
                        </button>
                        <button id="save-update-btn" class="glass-strip panel ov-dark neon hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105 hidden">
                            <i class="fas fa-save mr-2"></i> Save Update
                        </button>
                        <button id="copy-share-btn" class="bg-neutral-800 hover:bg-cyan-400 text-neutral-500 hover:text-black font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <input type="text" id="share-link-output" readonly class="w-full p-2 panel glass-strip ov-dark rounded-lg text-neutral-200 cursor-copy" placeholder="Click 'Generate Link' to create a shareable URL">
                </div>
            </div>

            <!-- Admin Page -->
            <div id="admin-page" class="hidden">
                <button id="save-data-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105">
                    Save All Changes
                </button>

                
            </div>
        </div>
    </div>

    <!-- Weather Integration -->
    <!-- <script src="public/weather-integration.js"></script> -->
    
    <!-- Modular Navigation: Debug script removed - using app.js modules instead -->
    <!-- JavaScript Modules -->
    <script type="module" src="/public/js/app.js"></script>
</body>
</html>
