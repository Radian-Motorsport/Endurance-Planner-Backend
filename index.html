<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner</title>
</head>
<body>
    <h1>Planner</h1>

    <div id="drivers">
        <h2>Drivers</h2>
        <table id="drivers-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Driver Number</th>
                    <th>iRating</th>
                    <th>License</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button onclick="addDriver()">Add Driver</button>
    </div>

    <hr>

    <div id="cars">
        <h2>Cars</h2>
        <table id="cars-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Fuel per Lap</th>
                    <th>Tank Capacity</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button onclick="addCar()">Add Car</button>
    </div>

    <hr>

    <div id="tracks">
        <h2>Tracks</h2>
        <table id="tracks-table">
            <thead>
                <tr>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button onclick="addTrack()">Add Track</button>
    </div>

    <hr>

    <button onclick="saveData()">Save to Server</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchDataAndPopulate();
        });

        function fetchDataAndPopulate() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    populateDrivers(data.drivers);
                    populateCars(data.cars);
                    populateTracks(data.tracks);
                })
                .catch(error => console.error('Error fetching data:', error));
        }
        
        function populateDrivers(drivers) {
            const tableBody = document.querySelector('#drivers-table tbody');
            tableBody.innerHTML = '';
            drivers.forEach(driver => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${driver.name}</td><td>${driver.drivernumber}</td><td>${driver.iRating}</td><td>${driver.license}</td>`;
                tableBody.appendChild(row);
            });
        }
        
        function populateCars(cars) {
            const tableBody = document.querySelector('#cars-table tbody');
            tableBody.innerHTML = '';
            cars.forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${car.name}</td><td>${car.fuelPerLap}</td><td>${car.tankCapacity}</td>`;
                tableBody.appendChild(row);
            });
        }
        
        function populateTracks(tracks) {
            const tableBody = document.querySelector('#tracks-table tbody');
            tableBody.innerHTML = '';
            tracks.forEach(track => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${track.name}</td>`;
                tableBody.appendChild(row);
            });
        }

        function addDriver() {
            const name = prompt("Enter driver's name:");
            const drivernumber = prompt("Enter driver's number:");
            const iRating = prompt("Enter driver's iRating:");
            const license = prompt("Enter driver's license:");
            if (name && drivernumber && iRating && license) {
                const tableBody = document.querySelector('#drivers-table tbody');
                const row = document.createElement('tr');
                row.innerHTML = `<td>${name}</td><td>${drivernumber}</td><td>${iRating}</td><td>${license}</td>`;
                tableBody.appendChild(row);
            }
        }
        
        function addCar() {
            const name = prompt("Enter car's name:");
            const fuelPerLap = prompt("Enter car's fuel per lap:");
            const tankCapacity = prompt("Enter car's tank capacity:");
            if (name && fuelPerLap && tankCapacity) {
                const tableBody = document.querySelector('#cars-table tbody');
                const row = document.createElement('tr');
                row.innerHTML = `<td>${name}</td><td>${fuelPerLap}</td><td>${tankCapacity}</td>`;
                tableBody.appendChild(row);
            }
        }
        
        function addTrack() {
            const name = prompt("Enter track's name:");
            if (name) {
                const tableBody = document.querySelector('#tracks-table tbody');
                const row = document.createElement('tr');
                row.innerHTML = `<td>${name}</td>`;
                tableBody.appendChild(row);
            }
        }

        function saveData() {
            const drivers = getDriversData();
            const cars = getCarsData();
            const tracks = getTracksData();
            const data = { drivers, cars, tracks };

            fetch('/api/data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                console.log('Success:', result);
                fetchDataAndPopulate();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function getDriversData() {
            const drivers = [];
            const driverRows = document.querySelectorAll('#drivers-table tr:not(:first-child)');
            driverRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                drivers.push({
                    name: cells[0].textContent,
                    drivernumber: parseInt(cells[1].textContent),
                    iRating: parseInt(cells[2].textContent),
                    license: cells[3].textContent
                });
            });
            return drivers;
        }

        function getCarsData() {
            const cars = [];
            const carRows = document.querySelectorAll('#cars-table tr:not(:first-child)');
            carRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cars.push({
                    name: cells[0].textContent,
                    fuelPerLap: parseFloat(cells[1].textContent),
                    tankCapacity: parseFloat(cells[2].textContent)
                });
            });
            return cars;
        }

        function getTracksData() {
            const tracks = [];
            const trackRows = document.querySelectorAll('#tracks-table tr:not(:first-child)');
            trackRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                tracks.push({
                    name: cells[0].textContent
                });
            });
            return tracks;
        }

    </script>
</body>
</html>
